{# base.njk - UPDATED #}
<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if title %}{{ title }}{% else %}Travelling Trails{% endif %}</title>
    <link rel="stylesheet" href="{{ '/styles/main.css' | url }}">
    {% if featuredImage %}
    <link rel="preload" as="image" href="{{ featuredImage | url }}">
    <meta property="og:image" content="{{ featuredImage | url }}">
    <meta name="twitter:image" content="{{ featuredImage | url }}">
    <meta name="twitter:card" content="summary_large_image">
    {% endif %}
    <style>
        @media (min-width: 640px) {
          .gallery-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
          }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 dark:text-gray-100">
    {% include "header.njk" %}

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {{ content | safe }}
    </main>

    {% include "footer.njk" %}

    <!-- Scripts -->
    <script src="{{ '/assets/js/main.js' | url }}"></script>
    <script src="{{ '/assets/js/lightbox.js' | url }}"></script>

    {% if page.url === '/search/' %}
    <script src="{{ '/assets/js/search.js' | url }}"></script>
    {% endif %}

    <!-- Image optimization script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('img:not([loading])').forEach(img => {
                img.setAttribute('loading', 'lazy');
            });

            document.querySelectorAll('img:not([decoding])').forEach(img => {
                img.setAttribute('decoding', 'async');
            });

            document.querySelectorAll('img').forEach(img => {
                img.addEventListener('error', function() {
                    this.src = '/assets/images/placeholder.jpg';
                    this.alt = 'Image not available';
                });
            });
        });
    </script>

    <!-- Dark mode image handling -->
    <script>
        function adjustImageBrightness() {
            if (document.documentElement.classList.contains('dark')) {
                document.querySelectorAll('img:not(.no-dark-adjust)').forEach(img => {
                    img.style.filter = 'brightness(0.8)';
                });
            } else {
                document.querySelectorAll('img').forEach(img => {
                    img.style.filter = '';
                });
            }
        }

        document.addEventListener('DOMContentLoaded', adjustImageBrightness);
        const observer = new MutationObserver(adjustImageBrightness);
        observer.observe(document.documentElement, { 
            attributes: true, 
            attributeFilter: ['class'] 
        });
    </script>
</body>
</html>